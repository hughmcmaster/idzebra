# Copyright (C) 1994-1999, Index Data
# All rights reserved.
# Sebastian Hammer, Adam Dickmeiss
# $Id: Makefile.in,v 1.7 1999-11-30 13:48:03 adam Exp $

SHELL=/bin/sh
MAKE=make
RANLIB=@RANLIB@
CC=@CC@
CPP=@CPP@
CDEFS=@DEFS@ @ODEFS@

# Where are Yaz libraries located?
YAZLIB=@YAZLIB@
# Where are Yaz header files located?
YAZINC=@YAZINC@
# If Yaz is compiled with mosi support uncomment and specify.
#OSILIB=../../xtimosi/src/libmosi.a ../../yaz/lib/librfc.a

# Tcl include files and libraries
TCL_INCLUDE=@TCL_INCLUDE@
TCL_LIB=@TCL_LIB@

# Some systems have seperate socket libraries
LIBS=@LIBS@

prefix=@prefix@
exec_prefix=@exec_prefix@

INSTALL=@INSTALL@
INSTALL_PROGRAM=@INSTALL_PROGRAM@
INSTALL_DATA=@INSTALL_DATA@

BUILD=@build_root@
BINDIR=$(exec_prefix)/bin
#  Public libraries and header files
LIBDIR=$(exec_prefix)/lib
INCDIR=$(prefix)/include
#  Misc tables, etc.
ZEBRADIR=$(prefix)/lib/zebra
ZEBRATAB=$(prefix)/lib/zebra/tab

SUBDIR=util bfile dfa dict isams isamc isam rset recctrl index

all:
	for i in $(SUBDIR); do cd $$i; if $(MAKE) OSILIB="$(OSILIB)" YAZLIB="$(YAZLIB)" YAZINC="$(YAZINC)" RANLIB="$(RANLIB)" CDEFS="$(CDEFS)" LIBS="$(LIBS)" CFLAGS="$(CFLAGS)" CC="$(CC)"; then cd ..; else exit 1; fi; done

dep depend:
	for i in $(SUBDIR); do cd $$i; if $(MAKE) CPP="$(CPP)" CDEFS="$(CDEFS)" YAZINC="$(YAZINC)" depend; then cd ..; else exit 1; fi; done

clean:
	for i in $(SUBDIR); do (cd $$i; $(MAKE) clean); done
	rm -f lib/*.a

cleanup:
	rm -f `find $(SUBDIR) -name "*.[oa]" -print`
	rm -f `find $(SUBDIR) -name "core" -print`
	rm -f `find $(SUBDIR) -name "errlist" -print`
	rm -f `find $(SUBDIR) -name "a.out" -print`

cleandepend: 
	for i in $(SUBDIR); do (cd $$i; \
		if sed '/^#Depend/q' <Makefile >Makefile.tmp; then \
		mv -f Makefile.tmp Makefile; fi; rm -f .depend); done

install:
	$(INSTALL) -d $(BUILD)$(BINDIR)
	$(INSTALL_PROGRAM) bin/zebraidx $(BUILD)$(BINDIR)
	$(INSTALL_PROGRAM) bin/zebrasrv $(BUILD)$(BINDIR)
	$(INSTALL) -d $(BUILD)$(ZEBRATAB)
	@cd tab; for f in *; do \
		if [ -f $$f ]; then \
			$(INSTALL_DATA) $$f $(BUILD)$(ZEBRATAB); \
		fi; \
	done

wc:
	wc `find . -name '*.[ch]'`

